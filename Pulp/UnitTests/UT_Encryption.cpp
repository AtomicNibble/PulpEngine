#include "stdafx.h"

#include "gtest/gtest.h"

#include "Encryption\Salsa20.h"

X_USING_NAMESPACE;

using namespace core;
using namespace core::Encryption;


TEST(Encrypt, Salsa20)
{
	const uint8_t TextIn[62] = "this is some thex that we arre going to encrypt with salsa20.";
	uint8_t EncryptedBuf[62];

	Salsa20::Key key = {
		0x7B, 0xD9, 0x2B, 0x0E, 0x53, 0xF7, 0x44, 0xFA,
		0xDF, 0x03, 0x0E, 0x55, 0xB3, 0x15, 0xC7, 0x2B,
		0x5C, 0x1D, 0x70, 0x70, 0xF5, 0x35, 0x72, 0xAE,
		0xE6, 0xD7, 0x0A, 0x36, 0x92, 0x0A, 0xD9, 0x91
	};
	Salsa20::Iv iv = {
		0x62, 0x28, 0x72, 0x6A,
		0x9F, 0x4F, 0x3B, 0x08
	};

	Salsa20 enc;

	enc.setKey(key);
	enc.setIv(iv);
	enc.processBytes(TextIn, EncryptedBuf, 62);

	// expected.
	const uint8_t Expected[62] = {
		0xfe, 0xa8, 0xf2, 0xf5, 0x25, 0x46, 0x60, 0xc9,
		0xc8, 0x1c, 0xe0, 0x33, 0xc6, 0x61, 0x5f, 0xc9,
		0xb5, 0xb0, 0xfc, 0x67, 0xe9, 0x9f, 0x67, 0x94,
		0x72, 0x04, 0x69, 0x53, 0x90, 0xfe, 0x95, 0x3e,
		0xd4, 0x3f, 0x20, 0x9f, 0x7f, 0x67, 0x7c, 0x88,
		0x91, 0x3f, 0xa0, 0x32, 0xf3, 0xfb, 0x6f, 0xae,
		0x48, 0x0e, 0x51, 0xe5, 0xd1, 0xd8, 0x1f, 0x44,
		0x7f, 0x3d, 0xef, 0x5a, 0xb5, 0x47 };

	EXPECT_TRUE(0 == std::memcmp(EncryptedBuf, Expected, sizeof(EncryptedBuf)));
}